<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>LIGHTRI â€” Fiches BIN avec lien visuel</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#f8f9fb;color:#111;margin:0;padding:20px}
h1{margin:0 0 8px 0;font-weight:600}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
textarea,input,button{font-family:inherit;font-size:15px}
textarea{width:100%;height:220px;padding:10px;border-radius:8px;border:1px solid #ccc;resize:vertical;background:#fff;color:#111}
button{padding:8px 12px;border-radius:8px;border:1px solid #999;background:#fff;cursor:pointer}
.note{font-size:13px;color:#666;margin-bottom:8px}
.progress{height:12px;background:#eee;border-radius:8px;overflow:hidden;margin:8px 0}
.progress>.bar{height:12px;background:#4caf50;width:0%;transition:width .18s linear}
#cardsGrid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:16px}
.cardWrap{background:#fff;border-radius:10px;padding:12px;border:1px solid #e6e6e6;display:flex;flex-direction:column;gap:8px}
.cardText{white-space:pre-wrap;font-family:inherit;font-size:14px;color:#111;line-height:1.35}
.cardLink{color:#0b66ff;text-decoration:none;font-weight:600}
</style>
</head>
<body>
<h1>ðŸ’³ LIGHTRI â€” Fiches BIN avec lien visuel</h1>
<div class="note">Colle ton texte ou charge un .txt. Format par ligne : <code>CardNumber | MM | YYYY | CVV | BankField | FullName | Address | City | Region | Zip | Phone | Email</code></div>

<div class="controls">
  <input id="file" type="file" accept=".txt,.json" />
  <button id="process">Traiter</button>
  <button id="download">TÃ©lÃ©charger fiches</button>
</div>

<div class="small">ProgrÃ¨s <span id="counter">0/0</span> â€” <span id="status">PrÃªt</span></div>
<div class="progress"><div class="bar" id="progressBar"></div></div>

<textarea id="input" placeholder="Colle ici ton texte brut..."></textarea>

<div id="cardsGrid"></div>

<script>
const API_BASE = "https://bincheck.io/api/v1/bin/";
const inputBox = document.getElementById('input');
const fileInput = document.getElementById('file');
const cardsGrid = document.getElementById('cardsGrid');
const progressBar = document.getElementById('progressBar');
const counterEl = document.getElementById('counter');
const statusEl = document.getElementById('status');

function setStatus(s){ statusEl.textContent=s; }
function updateProgress(done,total){ counterEl.textContent=`${done}/${total}`; progressBar.style.width = total? (done/total*100)+'%':'0%'; }
function digitsOnly(s){ return (s||'').toString().replace(/\D/g,''); }
function groupCard(n){ return digitsOnly(n).replace(/(\d{4})(?=\d)/g,'$1 '); }

async function fetchBinInfo(bin){
  try{
    const r = await fetch(API_BASE + encodeURIComponent(bin));
    if(!r.ok) throw new Error('HTTP '+r.status);
    return await r.json();
  }catch(e){ console.warn('fetchBinInfo failed',e); return null; }
}

function countryCodeToEmoji(cc){ if(!cc) return ''; cc=cc.toUpperCase(); if(cc.length!==2)return ''; const A=0x1F1E6; return String.fromCodePoint(A+cc.charCodeAt(0)-65,A+cc.charCodeAt(1)-65); }

function buildFicheText(carte, binInfo){
  const bank = (binInfo && binInfo.bank && binInfo.bank.name)?binInfo.bank.name:(carte.BankField||'Non spÃ©cifiÃ©');
  const brand = (binInfo && (binInfo.brand||binInfo.level))?(binInfo.brand||binInfo.level):'CLASSIC';
  const type = (binInfo && binInfo.type)?binInfo.type:'CREDIT';
  const country = (binInfo && binInfo.country && binInfo.country.alpha2)?binInfo.country.alpha2:'';
  const flag = countryCodeToEmoji(country);

  const lines=[];
  lines.push(`ðŸ’³ +1 IMPO.UHQ ${flag}`);
  lines.push('â”” '+groupCard(carte.CardNumber));
  lines.push('');
  lines.push('ðŸ¦ Informations Personnelles');
  lines.push('â”œ ðŸ•µï¸ Nom complet : '+(carte.FullName||''));
  lines.push('â”œ ðŸ  Adresse : '+(carte.Address||''));
  lines.push('â”œ ðŸ“® Zip : '+(carte.Zip||''));
  lines.push('â”œ ðŸ¢ Ville : '+(carte.City||''));
  lines.push('â”œ ðŸ“ž NumÃ©ro de tÃ©lÃ©phone : '+(carte.Phone||''));
  lines.push('â”” ðŸ“§ Email : '+(carte.Email||'Non fourni'));
  lines.push('');
  lines.push('ðŸ¦ Carte de Paiement');
  lines.push('â”œ ðŸ’ Titulaire : '+(carte.FullName||''));
  lines.push('â”œ ðŸ’³ NumÃ©ro de carte : '+groupCard(carte.CardNumber));
  lines.push('â”œ ðŸ’³ Bin : '+(carte.BIN||''));
  lines.push('â”œ ðŸ’³ Banque : '+bank);
  lines.push('â”œ ðŸ’³ Niveau : '+brand.toUpperCase());
  lines.push('â”œ ðŸ’³ Type : '+type.toUpperCase());
  lines.push('â”œ ðŸŽ¨ Visuel : '+`Lien ici`);
  lines.push('â”œ ðŸ“… Expiration : '+(carte.ExpMonth||'')+'/'+(carte.ExpYear||''));
  lines.push('â”” ðŸ”’ Cryptogramme visuel : '+(carte.CVV||''));
  return lines.join('\n');
}

async function processText(text){
  cardsGrid.innerHTML='';
  setStatus('Traitement...');
  const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  if(!lines.length){ setStatus('Aucune fiche'); return; }
  let done=0;
  const total=lines.length;
  updateProgress(done,total);

  for(const line of lines){
    const parts=line.split('|').map(p=>p.trim());
    while(parts.length<12) parts.push('');
    const carte={
      CardNumber:parts[0],
      ExpMonth:parts[1],
      ExpYear:parts[2],
      CVV:parts[3],
      BankField:parts[4],
      FullName:parts[5],
      Address:parts[6],
      City:parts[7],
      Region:parts[8],
      Zip:parts[9],
      Phone:parts[10],
      Email:parts[11]
    };
    const digits=digitsOnly(carte.CardNumber);
    if(digits.length<13){ done++; updateProgress(done,total); continue; }
    carte.BIN=digits.slice(0,6);

    const binInfo=await fetchBinInfo(carte.BIN);
    const ficheText=buildFicheText(carte, binInfo);

    const wrap=document.createElement('div'); wrap.className='cardWrap';
    const textDiv=document.createElement('div'); textDiv.className='cardText'; textDiv.textContent=ficheText;

    // lien cliquable vers placeholder
    const link = document.createElement('a');
    const textLabel = encodeURIComponent(`${carte.BankField || 'BANQUE'} ${carte.Level || 'CLASSIC'} ${carte.Type || 'CREDIT'}`);
    link.href=`https://via.placeholder.com/400x250.png?text=${textLabel}`;
    link.target='_blank';
    link.className='cardLink';
    link.textContent='ðŸŽ¨ Voir le visuel de la carte';
    
    wrap.appendChild(textDiv);
    wrap.appendChild(link);
    cardsGrid.appendChild(wrap);

    done++; updateProgress(done,total);
  }
  setStatus('TerminÃ© â€” '+total+' fiches.');
}

document.getElementById('process').addEventListener('click',()=>processText(inputBox.value.trim()));
document.getElementById('download').addEventListener('click',()=>{
  const texts=Array.from(document.querySelectorAll('.cardText')).map(n=>n.textContent);
  if(!texts.length){ alert('Rien Ã  tÃ©lÃ©charger'); return; }
  const blob=new Blob([texts.join('\n\n')],{type:'text/plain;charset=utf-8'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='LIGHTRI_fiches.txt'; document.body.appendChild(a); a.click(); a.remove();
});
fileInput.addEventListener('change', async (e)=>{
  const f=e.target.files[0]; if(!f) return;
  const txt=await f.text(); inputBox.value=txt; processText(txt);
});
</script>
</body>
</html>