<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LIGHTRI â€” Le Trieur des Murailles</title>

<!--
  THEME: Ã©pique (style "Shingeki no Kyojin" â€” heroic / sky / murailles)
  - Background image: Unsplash (libre de droit) â€” si tu prÃ©fÃ¨res une autre image, remplace URL ci-dessous.
  - Aucun asset sous licence restreinte n'est embarquÃ©.
-->

<style>
  :root{
    --bg-overlay: rgba(12,11,10,0.55);
    --accent: #cfa46b;
    --accent-2: #8fbfe6;
    --muted: #bfc9d9;
    --card-bg: rgba(8,8,10,0.6);
    --glass: rgba(255,255,255,0.03);
    --radius: 12px;
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; color:#f3f5f7}
  body{
    background-image: url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1800&auto=format&fit=crop&s=5e139f0f2c0d6f7b2c4a19b5e9a1b7e3');
    background-size:cover;
    background-position: center 30%;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
  }

  /* dark overlay */
  .overlay{
    position:fixed; inset:0; background:linear-gradient(180deg, rgba(2,6,23,0.45) 0%, rgba(2,6,23,0.65) 100%); pointer-events:none;
  }

  .wrap{
    width:100%; max-width:1100px; background: linear-gradient(180deg, rgba(6,8,12,0.28), rgba(2,4,6,0.5));
    border-radius:18px; box-shadow:0 10px 40px rgba(0,0,0,0.6); padding:22px; backdrop-filter: blur(6px);
    border: 1px solid rgba(255,255,255,0.04);
    position:relative;
  }

  header{
    display:flex; gap:18px; align-items:center; margin-bottom:16px;
  }
  .crest{
    width:86px; height:86px; border-radius:14px; background:linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.01)); 
    display:flex; align-items:center; justify-content:center; border:1px solid rgba(255,255,255,0.03);
    box-shadow: inset 0 -6px 18px rgba(0,0,0,0.45);
    flex-shrink:0;
  }
  /* stylized wings crest using CSS */
  .crest:before{
    content:""; display:block; width:64px; height:64px; background:
      radial-gradient(circle at 30% 35%, rgba(255,255,255,0.12), transparent 18%),
      radial-gradient(circle at 70% 65%, rgba(255,255,255,0.06), transparent 22%);
    border-radius:10px; transform:rotate(-8deg);
  }

  h1{
    margin:0; font-size:22px; letter-spacing:1px; color:#fff;
    display:flex; flex-direction:column;
  }
  h1 .title{
    font-weight:700; font-size:20px;
    display:flex; align-items:center; gap:12px;
  }
  h1 .subtitle{font-weight:300; color:var(--muted); font-size:12px; margin-top:4px}

  /* animated shine on title */
  .shiny{
    position:relative;
    display:inline-block;
    color:var(--accent);
    padding:6px 12px;
    border-radius:999px;
    background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow: 0 2px 10px rgba(0,0,0,0.5), inset 0 -6px 18px rgba(0,0,0,0.2);
    overflow:hidden;
  }
  .shiny:after{
    content:""; position:absolute; left:-40%; top:0; width:40%; height:100%;
    background: linear-gradient(90deg, rgba(255,255,255,0.0), rgba(255,255,255,0.25), rgba(255,255,255,0.0));
    transform: skewX(-12deg);
    animation: shine 4s linear infinite;
    opacity:0.9;
  }
  @keyframes shine{
    0% { left:-50% }
    50% { left:100% }
    100% { left:100% }
  }

  .controls{
    display:flex; gap:10px; margin-top:16px; flex-wrap:wrap; align-items:center;
  }
  input[type=file]{background:var(--glass); padding:10px 12px; border-radius:10px; color:var(--muted); border:1px solid rgba(255,255,255,0.03);}
  button{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); color:var(--accent-2);
    border:1px solid rgba(255,255,255,0.06); padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600;
    box-shadow: 0 6px 18px rgba(0,0,0,0.45);
  }
  button.secondary{background:transparent; border:1px dashed rgba(255,255,255,0.04); color:var(--muted); font-weight:500}
  .small{font-size:13px; color:var(--muted)}

  main{display:flex; gap:18px; margin-top:18px;}
  .left{flex:1; display:flex; flex-direction:column;}
  .right{width:420px; min-width:320px; max-width:420px}

  textarea#output{background:linear-gradient(180deg, rgba(5,8,12,0.55), rgba(12,12,12,0.45)); color:#eaf0ff; border-radius:12px; border:1px solid rgba(255,255,255,0.03); padding:14px; font-family:monospace; min-height:420px; resize:vertical}
  pre#log{background:rgba(0,0,0,0.34); color:#cbe6ff; padding:12px; border-radius:8px; min-height:120px; overflow:auto; font-family:monospace; font-size:13px}

  footer{margin-top:14px; display:flex; justify-content:space-between; align-items:center; color:var(--muted); font-size:13px}
  .note-box{background:rgba(255,255,255,0.02); padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.02)}

  /* responsive */
  @media (max-width:900px){
    main{flex-direction:column;}
    .right{width:100%}
  }
</style>
</head>
<body>
  <div class="overlay" aria-hidden="true"></div>

  <div class="wrap" role="application" aria-label="LIGHTRI Le Trieur des Murailles">
    <header>
      <div class="crest" aria-hidden="true"></div>
      <h1>
        <span class="title">
          <span class="shiny">LIGHTRI</span>
          <span class="small" style="color:var(--muted); margin-left:6px">â€” Le Trieur des Murailles</span>
        </span>
        <span class="subtitle">Trieur automatique de fichiers .txt â€¢ BIN lookup avec fallback</span>
      </h1>
    </header>

    <div class="controls" role="region" aria-label="ContrÃ´les">
      <input id="files" type="file" accept=".txt" multiple aria-label="SÃ©lectionner des fichiers txt">
      <button id="run">Traiter</button>
      <button id="download" class="secondary">TÃ©lÃ©charger</button>
      <label class="small" style="display:flex;align-items:center;gap:8px;color:var(--muted)">
        <input id="mask" type="checkbox"> Masquer numÃ©ros
      </label>
      <label class="small" style="display:flex;align-items:center;gap:8px;color:var(--muted)">
        <input id="allowPublicProxy" type="checkbox"> Autoriser proxy publics
      </label>
    </div>

    <main>
      <div class="left">
        <div class="note-box small" role="note">
          <strong>Aide rapide :</strong> chaque ligne du .txt doit Ãªtre au format :
          <code>CardNumber | ExpMonth | ExpYear | CVV | Bank | FullName | Address | City | City2 | Zip | Phone | Email</code>
          <div style="margin-top:6px;color:var(--muted)">Remplace <code>PROXY_ENDPOINTS</code> dans le code par tes endpoints serverless (Netlify/Vercel/GuideUp/NetchiFly) si tu en as.</div>
        </div>

        <textarea id="output" placeholder="RÃ©sultat..." readonly aria-label="RÃ©sultat formatÃ©"></textarea>
      </div>

      <aside class="right">
        <div style="margin-bottom:10px">
          <div class="small" style="margin-bottom:6px">Logs / DÃ©bogage</div>
          <pre id="log" aria-live="polite"></pre>
        </div>

        <div class="note-box small">
          <strong>ConfidentialitÃ© :</strong>
          <div style="margin-top:6px">Ne traitez ici que les cartes dont vous avez l'autorisation. Les proxys publics exposent les BINs Ã  des tiers.</div>
        </div>
      </aside>
    </main>

    <footer>
      <div class="small">Theme: Ã©pique â€¢ design inspirÃ©, images libres de droit</div>
      <div class="small">Built for you â€” LIGHTRI</div>
    </footer>
  </div>

<script>
/* ===========================
   LIGHTRI logic (JS)
   - Reads .txt files selected
   - Splits lines, fields
   - Cleans card numbers, extracts BIN (6 digits)
   - Tries direct Binlist lookup, then PROXY_ENDPOINTS, then optional public proxies
   - Fill result and allow download
   NOTE: Replace PROXY_ENDPOINTS with your serverless URLs (recommended).
   =========================== */

const fileInput = document.getElementById('files');
const runBtn = document.getElementById('run');
const output = document.getElementById('output');
const logEl = document.getElementById('log');
const downloadBtn = document.getElementById('download');
const maskCheckbox = document.getElementById('mask');
const allowPublicProxy = document.getElementById('allowPublicProxy');

// === CONFIGURE HERE ===
// If you deployed serverless functions (Netlify/Vercel/GuideUp/NetchiFly), put their base URLs here,
// each should expect a query param `?bin=123456` and return JSON from Binlist.
// Example:
// "https://mon-site.netlify.app/.netlify/functions/binlookup?bin="
// "https://mon-vercel.vercel.app/api/binlookup?bin="
const PROXY_ENDPOINTS = [
  // add your endpoints here, e.g. "https://ton-site.netlify.app/.netlify/functions/binlookup?bin="
];

// Public proxies (disabled unless user checks "Autoriser proxy publics")
const PUBLIC_PROXIES = [
  "https://corsproxy.io/?",
  "https://api.allorigins.win/raw?url="
];

function lg(...args){
  const s = args.map(a => (typeof a === 'string' ? a : JSON.stringify(a))).join(' ');
  logEl.textContent += s + "\\n";
  logEl.scrollTop = logEl.scrollHeight;
}

// display helper
function formatNumberGroups(s){
  return s.replace(/(\\d{4})(?=\\d)/g, '$1 ');
}
function maskCard(num){
  const s = (num||'').replace(/\\D/g,'');
  if(s.length <= 4) return '****';
  return '**** **** **** ' + s.slice(-4);
}

/* BIN lookup:
   1) try direct https://lookup.binlist.net/{bin}
   2) try user-provided PROXY_ENDPOINTS
   3) if user allowed, try PUBLIC_PROXIES
*/
async function binLookup(bin){
  bin = String(bin).slice(0,6);
  if(!/^[0-9]{6}$/.test(bin)) return null;

  const direct = `https://lookup.binlist.net/${bin}`;

  // Try direct
  try {
    lg('Trying direct Binlist for', bin);
    const r = await fetch(direct, { method:'GET', mode:'cors' });
    if(r.ok){
      const j = await r.json();
      lg('Direct Binlist success for', bin);
      return j;
    } else {
      lg('Direct Binlist returned', r.status);
    }
  } catch(e){
    lg('Direct Binlist fetch failed:', e && e.message ? e.message : e);
  }

  // Try user's endpoints
  for(const base of PROXY_ENDPOINTS){
    try {
      const url = base + encodeURIComponent(bin);
      lg('Trying endpoint', url);
      const r = await fetch(url, { method:'GET' });
      if(r.ok){
        const j = await r.json();
        lg('Endpoint success for', bin);
        return j;
      } else {
        lg('Endpoint returned', r.status);
      }
    } catch(e){
      lg('Endpoint fetch failed:', e && e.message ? e.message : e);
    }
  }

  // Try public proxies if allowed
  if(allowPublicProxy.checked){
    for(const p of PUBLIC_PROXIES){
      try {
        const url = p + encodeURIComponent(direct);
        lg('Trying public proxy', p);
        const r = await fetch(url, { method:'GET' });
        if(r.ok){
          const j = await r.json();
          lg('Public proxy success for', bin);
          return j;
        } else {
          lg('Public proxy returned', r.status);
        }
      } catch(e){
        lg('Public proxy failed:', e && e.message ? e.message : e);
      }
    }
  }

  lg('All BIN lookup attempts failed for', bin);
  return null;
}

function buildBlock({displayCard, Carte, CardDigits, BIN, binInfo}){
  const b = binInfo || {};
  const scheme = b.scheme || 'Non spÃ©cifiÃ©';
  const type = b.type || 'Non spÃ©cifiÃ©';
  const brand = b.brand || 'Non spÃ©cifiÃ©';
  const bankName = (b.bank && b.bank.name) || b.bankName || 'Non spÃ©cifiÃ©';
  const countryName = (b.country && b.country.name) || b.countryName || 'Non spÃ©cifiÃ©';

  return `ðŸ’³ +1 IMPO.UHQ ðŸ‡µðŸ‡¸
â”” ${displayCard}

ðŸ¦ Informations Personnelles
â”œ ðŸ•µï¸ Nom complet : ${Carte.FullName || ''}
â”œ ðŸ  Adresse : ${Carte.Address || ''}
â”œ ðŸ“® Zip : ${Carte.Zip || ''}
â”œ ðŸ¢ Ville : ${Carte.City || ''}
â”œ ðŸ“ž NumÃ©ro de tÃ©lÃ©phone : ${Carte.Phone || ''}
â”” ðŸ“§ Email : ${Carte.Email || ''}

ðŸ¦ Carte de Paiement
â”œ ðŸ’ Titulaire : ${Carte.FullName || ''}
â”œ ðŸ’³ NumÃ©ro de carte : ${displayCard}
â”œ ðŸ’³ Bin : ${BIN || 'Non spÃ©cifiÃ©'}
â”œ ðŸ’³ RÃ©seau : ${scheme}
â”œ ðŸ’³ Banque : ${bankName} (${countryName})
â”œ ðŸ’³ Niveau : ${brand}
â”œ ðŸ’³ Type : ${type}
â”œ ðŸ“… Expiration : ${Carte.ExpMonth || ''}/${Carte.ExpYear || ''}
â”” ðŸ”’ Cryptogramme visuel : ${Carte.CVV || ''}
`;
}

async function processFiles(fileList){
  output.value = '';
  logEl.textContent = '';
  const files = Array.from(fileList);
  if(files.length === 0){
    alert('Choisis au moins un fichier .txt');
    return;
  }
  lg('Starting processing', files.length, 'file(s)');
  let final = '';

  for(const file of files){
    lg('Reading', file.name);
    const text = await file.text();
    const lines = text.split(/\\r?\\n/);
    for(const raw of lines){
      const line = raw.trim();
      if(!line) continue;
      const parts = line.split('|').map(p => p.trim());
      while(parts.length < 12) parts.push('');
      const Carte = {
        CardNumber: parts[0]||'',
        ExpMonth: parts[1]||'',
        ExpYear: parts[2]||'',
        CVV: parts[3]||'',
        BankField: parts[4]||'',
        FullName: parts[5]||'',
        Address: parts[6]||'',
        City: parts[7]||'',
        City2: parts[8]||'',
        Zip: parts[9]||'',
        Phone: parts[10]||'',
        Email: parts[11]||'',
      };

      const CardDigits = (Carte.CardNumber || '').replace(/\\D/g,'');
      if(CardDigits.length < 6){
        lg('Skipping: card <6 digits:', CardDigits);
        continue;
      }
      const BIN = CardDigits.slice(0,6);
      const binInfo = await binLookup(BIN);
      const displayCard = maskCheckbox.checked ? maskCard(CardDigits) : formatNumberGroups(CardDigits);

      const block = buildBlock({displayCard, Carte, CardDigits, BIN, binInfo});
      final += block + "\\n";
      // small pause
      await new Promise(r => setTimeout(r, 120));
    }
  }

  output.value = final.trim();
  lg('Processing complete');
}

// UI hooks
runBtn.addEventListener('click', async ()=>{
  await processFiles(fileInput.files);
  alert('Traitement terminÃ©');
});

downloadBtn.addEventListener('click', ()=>{
  const txt = output.value;
  if(!txt){ alert('Aucun rÃ©sultat'); return; }
  const blob = new Blob([txt], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `LIGHTRI_Result_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.txt`;
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
});
</script>
</body>
</html>